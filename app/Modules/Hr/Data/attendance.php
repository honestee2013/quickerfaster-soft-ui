<?php

return [
  'model' => 'App\Modules\Hr\Models\Attendance',
  'fieldDefinitions' => [
    'employee_id' => [
      'display' => 'inline',
      'field_type' => 'select',
      'label' => 'Employee ID',
      'validation' => 'required|exists:employees,id',
      'relationship' => [
        'model' => 'App\Modules\Hr\Models\Employee',
        'type' => 'belongsTo',
        'display_field' => 'employee_number',
        'dynamic_property' => 'employee',
        'foreign_key' => 'employee_id',
        'inlineAdd' => false,
      ],
      'options' => [
        'model' => 'App\Modules\Hr\Models\Employee',
        'column' => 'employee_number',
        'hintField' => 'first_name,last_name',
      ],
    ],
    'employee_number' => [
      'display' => 'inline',
      'field_type' => 'string',
      'label' => 'Employee ID',
      'validation' => 'required',
    ],
    'company' => [
      'display' => 'inline',
      'field_type' => 'string',
      'label' => 'Company Division',
      'validation' => 'nullable',
    ],
    'department' => [
      'display' => 'inline',
      'field_type' => 'string',
      'label' => 'Department',
      'validation' => 'nullable',
    ],
    'date' => [
      'display' => 'inline',
      'field_type' => 'datepicker',
      'label' => 'Attendance Date',
      'validation' => 'required|date',
    ],
    'net_hours' => [
      'display' => 'inline',
      'field_type' => 'number',
      'label' => 'Total Hours Worked',
      'validation' => 'required|numeric|min:0',
    ],
    'status' => [
      'display' => 'inline',
      'field_type' => 'select',
      'label' => 'Attendance Status',
      'validation' => 'required',
      'options' => [
        'present' => 'Present',
        'absent' => 'Absent',
        'late' => 'Late Arrival',
        'half_day' => 'Half Day',
        'holiday' => 'Holiday',
        'leave' => 'On Leave',
      ],
    ],
    'sessions' => [
      'display' => 'inline',
      'field_type' => 'json',
      'label' => 'Work Sessions',
      'maxSizeMB' => 1,
    ],
    'shift_id' => [
      'display' => 'inline',
      'field_type' => 'select',
      'label' => 'Shift',
      'validation' => 'required|exists:shifts,id',
      'relationship' => [
        'model' => 'App\Modules\Hr\Models\Shift',
        'type' => 'belongsTo',
        'display_field' => 'name',
        'dynamic_property' => 'shift',
        'foreign_key' => 'shift_id',
        'inlineAdd' => false,
      ],
      'options' => [
        'model' => 'App\Modules\Hr\Models\Shift',
        'column' => 'name',
        'hintField' => '',
      ],
    ],
    'absence_type' => [
      'display' => 'inline',
      'field_type' => 'select',
      'label' => 'Absence Type',
      'validation' => 'nullable',
      'options' => [
        'planned_leave' => 'Planned Leave',
        'sick_leave' => 'Sick Leave (Reported)',
        'unplanned_absent' => 'Unplanned Absence',
        'late' => 'Late Arrival',
        'half_day' => 'Half Day',
        'excused' => 'Excused Absence',
      ],
    ],
    'is_unplanned' => [
      'display' => 'inline',
      'field_type' => 'boolcheckbox',
      'label' => 'Unplanned Absence',
      'validation' => 'boolean',
    ],
    'absence_reason' => [
      'display' => 'inline',
      'field_type' => 'textarea',
      'label' => 'Absence Reason',
      'validation' => 'nullable|string|max:1000',
    ],
    'is_paid_absence' => [
      'display' => 'inline',
      'field_type' => 'boolcheckbox',
      'label' => 'Paid Absence',
      'validation' => 'boolean',
    ],
    'hours_deducted' => [
      'display' => 'inline',
      'field_type' => 'number',
      'label' => 'Hours Deducted',
      'validation' => 'nullable|numeric|min:0|max:24',
    ],
    'is_approved' => [
      'display' => 'inline',
      'field_type' => 'boolcheckbox',
      'label' => 'Approved for Payroll',
      'validation' => 'boolean',
    ],
    'approved_by' => [
      'display' => 'inline',
      'field_type' => 'string',
      'label' => 'Approved By',
      'maxSizeMB' => 1,
    ],
    'approved_at' => [
      'display' => 'inline',
      'field_type' => 'datetimepicker',
      'label' => 'Approved At',
      'maxSizeMB' => 1,
    ],
    'notes' => [
      'display' => 'inline',
      'field_type' => 'textarea',
      'label' => 'Notes',
      'validation' => 'nullable|string|max:1000',
    ],
    'needs_review' => [
      'display' => 'inline',
      'field_type' => 'boolcheckbox',
      'label' => 'Needs Review',
      'validation' => 'boolean',
    ],
    'leave_request_id' => [
      'display' => 'inline',
      'field_type' => 'select',
      'label' => 'Linked Leave Request',
      'validation' => 'nullable|exists:leave_requests,id',
      'relationship' => [
        'model' => 'App\Modules\Hr\Models\LeaveRequest',
        'type' => 'belongsTo',
        'display_field' => 'id',
        'dynamic_property' => 'leaveRequest',
        'foreign_key' => 'leave_request_id',
        'inlineAdd' => false,
      ],
      'options' => [
        'model' => 'App\Modules\Hr\Models\LeaveRequest',
        'column' => 'id',
        'hintField' => '',
      ],
    ],
    'last_calculated_at' => [
      'display' => 'inline',
      'field_type' => 'datetimepicker',
      'label' => 'Last Calculated',
      'maxSizeMB' => 1,
    ],
    'calculation_method' => [
      'display' => 'inline',
      'field_type' => 'select',
      'label' => 'Calculation Method',
      'maxSizeMB' => 1,
      'options' => [
        'auto' => 'Automated from Clock Events',
        'manual' => 'Manually Entered',
        'adjusted' => 'Manually Adjusted',
      ],
    ],
    'attendanceSessions' => [
      'field_type' => 'checkbox',
      'relationship' => [
        'model' => 'App\Modules\Hr\Models\AttendanceSession',
        'type' => 'hasMany',
        'display_field' => 'duration_hours',
        'hintField' => 'session_type',
        'dynamic_property' => 'attendanceSessions',
        'foreign_key' => 'attendance_id',
        'local_key' => 'id',
        'inlineAdd' => false,
      ],
      'options' => [
        'model' => 'App\Modules\Hr\Models\AttendanceSession',
        'column' => 'duration_hours',
        'hintField' => 'session_type',
      ],
      'label' => 'Attendancesessions',
      'multiSelect' => true,
      'display' => 'inline',
    ],
    'adjustments' => [
      'field_type' => 'checkbox',
      'relationship' => [
        'model' => 'App\Modules\Hr\Models\AttendanceAdjustment',
        'type' => 'hasMany',
        'display_field' => 'id',
        'hintField' => 'employee.employee_number',
        'dynamic_property' => 'adjustments',
        'foreign_key' => 'attendance_id',
        'local_key' => 'id',
        'inlineAdd' => false,
      ],
      'options' => [
        'model' => 'App\Modules\Hr\Models\AttendanceAdjustment',
        'column' => 'id',
        'hintField' => 'employee.employee_number',
      ],
      'label' => 'Adjustments',
      'multiSelect' => true,
      'display' => 'inline',
    ],
  ],
  'hiddenFields' => [
    'onTable' => [
      '0' => 'adjustments',
      '1' => 'employee_id',
      '2' => 'leave_request_id',
      '3' => 'attendanceSessions',
      '4' => 'sessions',
      '5' => 'approved_by',
      '6' => 'approved_at',
      '7' => 'last_calculated_at',
      '8' => 'calculation_method',
      '9' => 'is_unplanned',
    ],
    'onNewForm' => [
      '0' => 'adjustments',
      '1' => 'employee_id',
      '2' => 'needs_review',
      '3' => 'hours_deducted',
      '4' => 'is_paid_absence',
      '5' => 'absence_reason',
      '6' => 'is_unplanned',
      '7' => 'absence_type',
      '8' => 'notes',
      '9' => 'is_approved',
      '10' => 'leave_request_id',
      '11' => 'attendanceSessions',
      '12' => 'sessions',
      '13' => 'is_approved',
      '14' => 'approved_by',
      '15' => 'approved_at',
      '16' => 'last_calculated_at',
      '17' => 'calculation_method',
      '18' => 'is_unplanned',
    ],
    'onEditForm' => [
      '0' => 'adjustments',
      '1' => 'employee_id',
      '2' => 'needs_review',
      '3' => 'hours_deducted',
      '4' => 'is_paid_absence',
      '5' => 'absence_reason',
      '6' => 'is_unplanned',
      '7' => 'absence_type',
      '8' => 'notes',
      '9' => 'is_approved',
      '10' => 'leave_request_id',
      '11' => 'attendanceSessions',
      '12' => 'sessions',
      '13' => 'approved_by',
      '14' => 'approved_at',
      '15' => 'last_calculated_at',
      '16' => 'calculation_method',
      '17' => 'is_unplanned',
    ],
    'onQuery' => [],
  ],
  'simpleActions' => [
    '0' => 'show',
  ],
  'isTransaction' => false,
  'dispatchEvents' => false,
  'controls' => [
    'files' => [
      'export' => [
        '0' => 'xls',
        '1' => 'csv',
        '2' => 'pdf',
      ],
      'print' => true,
    ],
    'bulkActions' => [
      'export' => [
        '0' => 'xls',
        '1' => 'csv',
        '2' => 'pdf',
      ],
      'updateModelFields' => [
        'is_approved' => [
          'label' => 'Approve attendance',
          'value' => true,
        ],
        'needs_review' => [
          'label' => 'Mark as needs review',
          'value' => true,
        ],
      ],
    ],
    'perPage' => [
      '0' => 10,
      '1' => 25,
      '2' => 50,
      '3' => 100,
    ],
    'search' => true,
    'showHideColumns' => true,
    'filterColumns' => true,
    'filters' => [
      '0' => [
        'field' => 'employee_id',
        'type' => 'select',
        'optionsFrom' => 'employees',
        'label' => 'Employee',
      ],
      '1' => [
        'field' => 'status',
        'type' => 'select',
        'options' => [
          '0' => 'All',
          '1' => 'Present',
          '2' => 'Absent',
          '3' => 'Late',
          '4' => 'Half Day',
          '5' => 'Holiday',
          '6' => 'Leave',
        ],
        'label' => 'Status',
      ],
      '2' => [
        'field' => 'is_approved',
        'type' => 'select',
        'options' => [
          '0' => 'All',
          '1' => 'Approved',
          '2' => 'Pending Approval',
        ],
        'label' => 'Approval Status',
      ],
      '3' => [
        'field' => 'needs_review',
        'type' => 'select',
        'options' => [
          '0' => 'All',
          '1' => 'Needs Review',
          '2' => 'No Issues',
        ],
        'label' => 'Review Status',
      ],
      '4' => [
        'field' => 'date',
        'type' => 'date_range',
        'label' => 'Date Range',
      ],
      '5' => [
        'field' => 'absence_type',
        'type' => 'select',
        'options' => [
          '0' => 'All',
          '1' => 'Planned Leave',
          '2' => 'Sick Leave',
          '3' => 'Unplanned Absence',
          '4' => 'Late',
          '5' => 'Half Day',
        ],
        'label' => 'Absence Type',
      ],
    ],
  ],
  'fieldGroups' => [
    'employee_info' => [
      'title' => 'Employee & Date',
      'groupType' => 'hr',
      'icon' => 'fas fa-user',
      'fields' => [
        '0' => 'employee_id',
        '1' => 'date',
        '2' => 'status',
      ],
    ],
    'hours_summary' => [
      'title' => 'Hours Summary',
      'groupType' => 'hr',
      'icon' => 'fas fa-clock',
      'fields' => [
        '0' => 'net_hours',
        '1' => 'calculation_method',
      ],
    ],
    'approval' => [
      'title' => 'Approval',
      'groupType' => 'hr',
      'icon' => 'fas fa-check-double',
      'fields' => [
        '0' => 'is_approved',
        '1' => 'approved_by',
        '2' => 'approved_at',
        '3' => 'needs_review',
        '4' => 'notes',
      ],
    ],
    'absence_details' => [
      'title' => 'Leave & Absence Details',
      'groupType' => 'hr',
      'icon' => 'fas fa-calendar-times',
      'fields' => [
        '0' => 'leave_request_id',
        '1' => 'absence_type',
        '2' => 'absence_reason',
        '3' => 'is_unplanned',
      ],
    ],
    'payroll_impact' => [
      'title' => 'Payroll Impact',
      'groupType' => 'hr',
      'icon' => 'fas fa-calculator',
      'fields' => [
        '0' => 'is_paid_absence',
        '1' => 'hours_deducted',
      ],
    ],
    'system_info' => [
      'title' => 'System Information',
      'groupType' => 'hr',
      'icon' => 'fas fa-server',
      'fields' => [
        '0' => 'sessions',
        '1' => 'last_calculated_at',
      ],
    ],
  ],
  'moreActions' => [
    '0' => [
      'title' => 'Approve for Payroll',
      'appendSeparator' => true,
      'icon' => 'fas fa-check-circle',
      'updateModelField' => true,
      'fieldName' => 'is_approved',
      'fieldValue' => true,
      'actionName' => 'approve_attendance',
      'confirm' => 'Approve this attendance for payroll processing?',
      'requiredRole' => [
        '0' => 'payroll_officer',
        '1' => 'hr_admin',
      ],
      'condition' => [
        'is_approved' => false,
        'is_locked' => false,
      ],
    ],
    '1' => [
      'title' => 'Request Review',
      'icon' => 'fas fa-exclamation-triangle',
      'updateModelField' => true,
      'fieldName' => 'needs_review',
      'fieldValue' => true,
      'actionName' => 'request_attendance_review',
      'requiredRole' => [
        '0' => 'supervisor',
        '1' => 'manager',
        '2' => 'hr_admin',
        '3' => 'payroll_officer',
      ],
      'requiredPermission' => 'attendance.review.request',
      'condition' => [
        'needs_review' => false,
        'is_approved' => false,
      ],
    ],
    '2' => [
      'title' => 'Mark as Resolved',
      'appendSeparator' => true,
      'icon' => 'fas fa-check',
      'updateModelField' => true,
      'fieldName' => 'needs_review',
      'fieldValue' => false,
      'actionName' => 'resolve_attendance_review',
      'requiredRole' => [
        '0' => 'manager',
        '1' => 'hr_admin',
      ],
      'condition' => [
        'needs_review' => true,
      ],
    ],
    '3' => [
      'title' => 'Adjust Attendance',
      'icon' => 'fas fa-edit',
      'url' => 'adjust-attendance',
      'params' => [
        'attendance_id' => '{id}',
      ],
      'requiredRole' => [
        '0' => 'manager',
        '1' => 'hr_admin',
      ],
      'condition' => [
        'is_approved' => false,
        'is_locked' => false,
      ],
    ],
    '4' => [
      'title' => 'Recalculate Hours',
      'appendSeparator' => true,
      'icon' => 'fas fa-redo-alt',
      'dispatchStandardEvent' => true,
      'eventClass' => 'App\Modules\System\Events\DataTableFormEvent',
      'params' => [
        'attendance_id' => '{id}',
        'actions' => [
          '0' => 'recalculateAttendanceHours',
        ],
      ],
      'confirm' => 'Recalculate hours from clock events? This will overwrite manual adjustments.',
      'requiredRole' => [
        '0' => 'hr_admin',
        '1' => 'system_admin',
      ],
      'condition' => [
        'is_approved' => false,
      ],
    ],
    '5' => [
      'title' => 'View Work Sessions',
      'icon' => 'fas fa-history',
      'url' => 'attendance-work-sessions',
      'newTab' => true,
      'params' => [
        'attendance_id' => '{id}',
      ],
      'requiredRole' => [
        '0' => 'employee',
        '1' => 'supervisor',
        '2' => 'manager',
        '3' => 'hr_admin',
        '4' => 'payroll_officer',
      ],
      'requiredScope' => 'view_employee_data',
    ],
    '6' => [
      'title' => 'Export Timesheet',
      'icon' => 'fas fa-file-export',
      'requiredRole' => [
        '0' => 'payroll_officer',
      ],
      'params' => [
        'attendance_id' => '{id}',
      ],
      'condition' => [
        'is_approved' => false,
        'is_locked' => false,
      ],
    ],
  ],
  'switchViews' => [
    'default' => 'list',
    'card' => [
      'titleFields' => [
        '0' => 'employee.first_name',
        '1' => 'employee.last_name',
      ],
      'subtitleFields' => [
        '0' => 'date',
        '1' => 'status',
      ],
      'contentFields' => [
        '0' => 'net_hours',
      ],
      'badgeField' => 'is_approved',
      'badgeColors' => [
        'true' => 'success',
        'false' => 'warning',
      ],
    ],
    'list' => [
      'titleFields' => [
        '0' => 'employee.first_name',
        '1' => 'employee.last_name',
      ],
      'subtitleFields' => [
        '0' => 'date',
        '1' => 'status',
      ],
      'contentFields' => [
        '0' => 'net_hours',
        '1' => 'absence_type',
      ],
      'badgeField' => 'needs_review',
      'badgeColors' => [
        'true' => 'danger',
        'false' => 'secondary',
      ],
    ],
    'detail' => [
      'layout' => 'tab',
      'detailType' => 'record',
      'titleFields' => [
        '0' => 'employee.first_name',
        '1' => 'employee.last_name',
      ],
      'subtitleFields' => [
        '0' => 'date',
        '1' => 'status',
      ],
      'tabs' => [
        '0' => [
          'title' => 'Overview',
          'icon' => 'fas fa-info-circle',
          'fields' => [
            '0' => 'employee_id',
            '1' => 'date',
            '2' => 'status',
            '3' => 'net_hours',
            '4' => 'is_approved',
            '5' => 'notes',
          ],
        ],
        '1' => [
          'title' => 'Work Sessions',
          'icon' => 'fas fa-history',
          'relation' => 'attendanceSessions',
        ],
        '2' => [
          'title' => 'Absence Details',
          'icon' => 'fas fa-calendar-times',
          'fields' => [
            '0' => 'leave_request_id',
            '1' => 'absence_type',
            '2' => 'absence_reason',
            '3' => 'is_paid_absence',
            '4' => 'hours_deducted',
          ],
        ],
        '3' => [
          'title' => 'Approval History',
          'icon' => 'fas fa-check-double',
          'fields' => [
            '0' => 'is_approved',
            '1' => 'approved_by',
            '2' => 'approved_at',
            '3' => 'needs_review',
            '4' => 'last_calculated_at',
          ],
        ],
      ],
    ],
  ],
  'relations' => [
    'employee' => [
      'type' => 'belongsTo',
      'model' => 'App\Modules\Hr\Models\Employee',
      'foreignKey' => 'employee_id',
      'displayField' => 'employee_number',
      'hintField' => 'first_name,last_name',
    ],
    'attendanceSessions' => [
      'type' => 'hasMany',
      'model' => 'App\Modules\Hr\Models\AttendanceSession',
      'foreignKey' => 'attendance_id',
      'orderBy' => 'start_time',
      'addToDetail' => true,
      'displayField' => 'duration_hours',
      'hintField' => 'session_type',
    ],
    'adjustments' => [
      'type' => 'hasMany',
      'model' => 'App\Modules\Hr\Models\AttendanceAdjustment',
      'foreignKey' => 'attendance_id',
      'displayField' => 'id',
      'hintField' => 'employee.employee_number',
    ],
    'leaveRequest' => [
      'type' => 'belongsTo',
      'model' => 'App\Modules\Hr\Models\LeaveRequest',
      'foreignKey' => 'leave_request_id',
      'displayField' => 'id',
    ],
    'shift' => [
      'type' => 'belongsTo',
      'model' => 'App\Modules\Hr\Models\Shift',
      'foreignKey' => 'shift_id',
      'displayField' => 'name',
    ],
  ],
  'report' => [],
];
